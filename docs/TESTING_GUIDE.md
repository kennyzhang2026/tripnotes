# 游记助手测试指南

> 版本: v0.2.0
> 更新时间: 2026-02-19

---

## 测试准备

### 1. 环境配置

```bash
# 安装依赖
pip install -r requirements.txt

# 配置 .streamlit/secrets.toml
# 参考文档: docs/ALIYUN_SETUP.md, docs/TABLE_SETUP.md
```

### 2. 启动应用

```bash
# 方式一：本地运行
streamlit run app.py

# 方式二：指定端口
streamlit run app.py --server.port 8501
```

---

## 手动测试清单

### 一、用户认证测试

#### 1.1 注册测试
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 正常注册 | 输入用户名(3+字符)和密码(6+字符) | 注册成功，跳转登录页 |
| 用户名过短 | 输入1-2字符用户名 | 提示"至少需要3个字符" |
| 密码过短 | 输入1-5字符密码 | 提示"至少需要6个字符" |
| 密码不匹配 | 两次输入不同密码 | 提示"两次输入的密码不一致" |
| 重复注册 | 使用已存在用户名注册 | 提示"用户名已被注册" |

#### 1.2 登录测试
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 正常登录 | 输入正确用户名和密码 | 登录成功，跳转首页 |
| 错误密码 | 输入错误密码 | 提示"用户名或密码错误" |
| 不存在用户 | 输入不存在的用户名 | 提示"用户名或密码错误" |

---

### 二、创建游记测试

#### 2.1 基本流程
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 创建游记 | 上传照片 → 添加备注 → 生成游记 | 游记创建成功 |
| 无地点创建 | 不填写地点直接生成 | 提示"请填写地点/景区" |
| 无照片创建 | 不上传照片直接生成 | 提示"请先至少添加一张照片" |

#### 2.2 照片上传
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 上传 JPG | 上传 .jpg 格式图片 | 显示图片预览 |
| 上传 PNG | 上传 .png 格式图片 | 显示图片预览 |
| 不支持格式 | 上传 .gif 格式图片 | 提示格式不支持 |

#### 2.3 OCR 识别
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 有文字照片 | 上传包含文字的照片并点击 OCR | 显示识别文字 |
| 无文字照片 | 上传风景照并点击 OCR | 提示"未识别到文字" |

#### 2.4 语音识别
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 上传音频 | 上传 .wav/.mp3 文件并转换 | 显示识别文字 |
| 无音频 | 不上传音频直接转换 | 提示错误 |

---

### 三、游记管理测试

#### 3.1 游记列表
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 查看列表 | 点击"我的游记" | 显示所有游记卡片 |
| 搜索游记 | 输入地点或标题搜索 | 显示匹配结果 |
| 排序 | 切换排序方式 | 列表按新排序显示 |
| 空列表 | 新用户无游记时 | 显示"还没有游记"提示 |

#### 3.2 游记详情
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 查看详情 | 点击游记卡片查看按钮 | 显示完整游记内容 |
| 查看照片 | 滚动到照片区域 | 显示所有照片 |
| 导出 Markdown | 点击导出选择 Markdown | 可下载 .md 文件 |
| 导出文本 | 点击导出选择纯文本 | 可下载 .txt 文件 |

#### 3.3 游记编辑
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 编辑标题 | 修改标题并保存 | 标题更新成功 |
| 编辑内容 | 修改游记内容并保存 | 内容更新成功 |
| 添加照片 | 上传新照片并保存 | 照片添加成功 |
| 删除照片 | 删除照片并保存 | 照片删除成功 |
| 重新生成 | 点击重新生成按钮 | 生成新游记内容 |

#### 3.4 游记删除
| 测试项 | 操作 | 预期结果 |
|--------|------|----------|
| 删除游记 | 点击删除并确认 | 游记删除成功 |
| 取消删除 | 点击删除后取消 | 游记保留 |

---

### 四、集成测试

#### 4.1 完整流程
1. 注册新用户
2. 登录
3. 创建游记（上传照片、添加备注）
4. 查看游记列表
5. 查看游记详情
6. 编辑游记
7. 导出游记
8. 退出登录

#### 4.2 多用户测试
1. 创建多个用户
2. 各自创建游记
3. 验证用户只能看到自己的游记

---

## 自动化测试

### 运行单元测试

```bash
# 方式一：使用 unittest
python -m unittest discover tests

# 方式二：使用 pytest（需安装）
pip install pytest
pytest tests/ -v
```

### 测试覆盖率

```bash
# 安装 coverage
pip install coverage

# 运行测试并生成报告
coverage run -m unittest discover tests
coverage report
coverage html  # 生成 HTML 报告
```

---

## 常见问题排查

### 问题 1: 飞书 API 报错
- 检查 `.streamlit/secrets.toml` 中的飞书配置
- 确认飞书应用权限已正确设置
- 参考: `docs/TABLE_SETUP.md`

### 问题 2: OCR 识别失败
- 检查阿里云 Access Key 配置
- 确认 OCR 服务已开通
- 参考: `docs/ALIYUN_SETUP.md`

### 问题 3: 图片上传失败
- 检查 OSS Bucket 名称和配置
- 确认 Bucket 权限为公共读
- 检查网络连接

### 问题 4: AI 生成失败
- 检查 DeepSeek API Key 配置
- 确认 API 额度充足
- 检查网络连接

---

## 测试报告模板

```
测试日期: ___________
测试人员: ___________
应用版本: v0.2.0

测试结果:
- 用户认证: ☑ 通过 / ☐ 失败
- 创建游记: ☑ 通过 / ☐ 失败
- 游记管理: ☑ 通过 / ☐ 失败
- OCR 识别: ☑ 通过 / ☐ 失败
- 语音识别: ☑ 通过 / ☐ 失败
- 游记导出: ☑ 通过 / ☐ 失败

发现问题:
1. ___________
2. ___________

改进建议:
1. ___________
2. ___________
```
